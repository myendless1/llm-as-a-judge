# example train data
"""
{
    "question_id": 81, 
    "model_1": "alpaca-13b", 
    "model_2": "gpt-3.5-turbo", 
    "g1_winner": "model_2", 
    "g2_winner": "model_2", 
    "judge": ["gpt-4", "pair-v2"], 
    "g1_user_prompt": "[User Question]\nCompose an engaging travel blog post about a recent trip to Hawaii, highlighting cultural experiences and must-see attractions.\n\n[The Start of Assistant A's Answer]\nI recently had the pleasure of visiting Hawaii and it quickly became one of my favorite places. From the stunning beaches to the lush mountains, this place has it all. The people are incredibly friendly and the culture is alive and well. One of the highlights of my trip was visiting the Polynesian Cultural Center. Here, I was able to learn about the culture of the native Hawaiian people and try my hand at traditional crafts and activities. I also had a chance to explore some of the natural wonders of the island, including the breathtaking Hanauma Bay and the majestic Waimea Canyon. Whether you\u2019re looking for a relaxing beach vacation or an adventure filled with culture and nature, Hawaii is the perfect destination.\n[The End of Assistant A's Answer]\n\n[The Start of Assistant B's Answer]\nAloha! I recently had the pleasure of embarking on a trip to the beautiful island of Hawaii, and let me tell you, the cultural experiences and must-see attractions did not disappoint.\n\nFirst on my list was a visit to the Polynesian Cultural Center. This interactive experience immerses you in the cultures of the Pacific Islands, from the intricate dances of the Maori people of New Zealand to the fire knife dancing of Samoa. The center also features a canoe pageant, where different island nations showcase their unique styles of canoeing. It was truly a feast for the senses and a fascinating insight into the diverse cultures of the Pacific.\n\nNext up was a trip to the North Shore, which boasts some of the best surf spots in the world. I watched in awe as surfers of all levels tackled the massive waves, and even had the chance to take a lesson myself. It was an exhilarating experience, and I left with a newfound respect for the power of the ocean.\n\nOf course, no trip to Hawaii would be complete without a visit to Pearl Harbor. The somber memorial serves as a reminder of the sacrifices made during World War II, and it was a deeply moving experience to pay my respects to the brave men and women who lost their lives on that fateful day.\n\nLast but not least, I made sure to indulge in some of the local cuisine. From poke bowls to shave ice, the flavors of Hawaii are truly unique and delicious. A personal favorite was the plate lunch, which typically consists of a protein, rice, and macaroni salad. It may not be the healthiest option, but it sure is tasty!\n\nOverall, my trip to Hawaii was an unforgettable experience. The cultural immersion, natural beauty, and delicious food all contributed to an incredible adventure. If you're looking for a destination that has it all, Hawaii should definitely be at the top of your list. Mahalo for reading!\n[The End of Assistant B's Answer]", 
    "g1_judgment": "Both assistants provided engaging and detailed responses to the user's request for a travel blog post about a recent trip to Hawaii. However, Assistant B's response was more comprehensive and detailed. It included more cultural experiences, such as the fire knife dancing of Samoa and the canoe pageant at the Polynesian Cultural Center, and more must-see attractions, like the North Shore and Pearl Harbor. Assistant B also mentioned trying local cuisine, which adds another layer of cultural experience to the trip. Therefore, Assistant B's response was more engaging and provided a more complete picture of a trip to Hawaii. So, my final verdict is [[B]].", 
    "g2_user_prompt": "[User Question]\nCompose an engaging travel blog post about a recent trip to Hawaii, highlighting cultural experiences and must-see attractions.\n\n[The Start of Assistant A's Answer]\nAloha! I recently had the pleasure of embarking on a trip to the beautiful island of Hawaii, and let me tell you, the cultural experiences and must-see attractions did not disappoint.\n\nFirst on my list was a visit to the Polynesian Cultural Center. This interactive experience immerses you in the cultures of the Pacific Islands, from the intricate dances of the Maori people of New Zealand to the fire knife dancing of Samoa. The center also features a canoe pageant, where different island nations showcase their unique styles of canoeing. It was truly a feast for the senses and a fascinating insight into the diverse cultures of the Pacific.\n\nNext up was a trip to the North Shore, which boasts some of the best surf spots in the world. I watched in awe as surfers of all levels tackled the massive waves, and even had the chance to take a lesson myself. It was an exhilarating experience, and I left with a newfound respect for the power of the ocean.\n\nOf course, no trip to Hawaii would be complete without a visit to Pearl Harbor. The somber memorial serves as a reminder of the sacrifices made during World War II, and it was a deeply moving experience to pay my respects to the brave men and women who lost their lives on that fateful day.\n\nLast but not least, I made sure to indulge in some of the local cuisine. From poke bowls to shave ice, the flavors of Hawaii are truly unique and delicious. A personal favorite was the plate lunch, which typically consists of a protein, rice, and macaroni salad. It may not be the healthiest option, but it sure is tasty!\n\nOverall, my trip to Hawaii was an unforgettable experience. The cultural immersion, natural beauty, and delicious food all contributed to an incredible adventure. If you're looking for a destination that has it all, Hawaii should definitely be at the top of your list. Mahalo for reading!\n[The End of Assistant A's Answer]\n\n[The Start of Assistant B's Answer]\nI recently had the pleasure of visiting Hawaii and it quickly became one of my favorite places. From the stunning beaches to the lush mountains, this place has it all. The people are incredibly friendly and the culture is alive and well. One of the highlights of my trip was visiting the Polynesian Cultural Center. Here, I was able to learn about the culture of the native Hawaiian people and try my hand at traditional crafts and activities. I also had a chance to explore some of the natural wonders of the island, including the breathtaking Hanauma Bay and the majestic Waimea Canyon. Whether you\u2019re looking for a relaxing beach vacation or an adventure filled with culture and nature, Hawaii is the perfect destination.\n[The End of Assistant B's Answer]", 
    "g2_judgment": "Assistant A's response is more detailed and engaging, providing a vivid description of the experiences and attractions in Hawaii. It covers a range of activities from cultural experiences at the Polynesian Cultural Center, surfing at the North Shore, visiting the Pearl Harbor memorial, to trying local cuisine. It also includes personal reflections and recommendations, making it more engaging for readers. \n\nOn the other hand, Assistant B's response, while still relevant and accurate, lacks the depth and detail of Assistant A's. It mentions the Polynesian Cultural Center, Hanauma Bay, and Waimea Canyon, but does not provide much detail about these experiences. \n\nTherefore, Assistant A's response is more helpful and engaging for someone looking to learn about a trip to Hawaii. \n\nFinal verdict: [[A]]", 
    "turn": 1, 
    "tstamp": 1686804127.3310158
    }
"""
"""
{
    "question_id": 81, 
    "model_1": "alpaca-13b", 
    "model_2": "gpt-3.5-turbo", 
    "g1_winner": "model_2", 
    "g2_winner": "model_2", 
    "judge": ["gpt-4", "pair-v2-multi-turn"], 
    "g1_user_prompt": "<|The Start of Assistant A's Conversation with User|>\n\n### User:\nCompose an engaging travel blog post about a recent trip to Hawaii, highlighting cultural experiences and must-see attractions.\n\n### Assistant A:\nI recently had the pleasure of visiting Hawaii and it quickly became one of my favorite places. From the stunning beaches to the lush mountains, this place has it all. The people are incredibly friendly and the culture is alive and well. One of the highlights of my trip was visiting the Polynesian Cultural Center. Here, I was able to learn about the culture of the native Hawaiian people and try my hand at traditional crafts and activities. I also had a chance to explore some of the natural wonders of the island, including the breathtaking Hanauma Bay and the majestic Waimea Canyon. Whether you\u2019re looking for a relaxing beach vacation or an adventure filled with culture and nature, Hawaii is the perfect destination.\n\n### User:\nRewrite your previous response. Start every sentence with the letter A.\n\n### Assistant A:\nAloha! I recently had the pleasure of visiting Hawaii and it quickly became one of my favorite places. From the stunning beaches to the lush mountains, this place has it all. The people are incredibly friendly and the culture is alive and well. One of the highlights of my trip was visiting the Polynesian Cultural Center. Here, I was able to learn about the culture of the native Hawaiian people and try my hand at traditional crafts and activities. I also had a chance to explore some of the natural wonders of the island, including the breathtaking Hanauma Bay and the majestic Waimea Canyon. Whether you\u2019re looking for a relaxing beach vacation or an adventure filled with culture and nature, Hawaii is the perfect destination.\n\n<|The End of Assistant A's Conversation with User|>\n\n\n<|The Start of Assistant B's Conversation with User|>\n\n### User:\nCompose an engaging travel blog post about a recent trip to Hawaii, highlighting cultural experiences and must-see attractions.\n\n### Assistant B:\nAloha! I recently had the pleasure of embarking on a trip to the beautiful island of Hawaii, and let me tell you, the cultural experiences and must-see attractions did not disappoint.\n\nFirst on my list was a visit to the Polynesian Cultural Center. This interactive experience immerses you in the cultures of the Pacific Islands, from the intricate dances of the Maori people of New Zealand to the fire knife dancing of Samoa. The center also features a canoe pageant, where different island nations showcase their unique styles of canoeing. It was truly a feast for the senses and a fascinating insight into the diverse cultures of the Pacific.\n\nNext up was a trip to the North Shore, which boasts some of the best surf spots in the world. I watched in awe as surfers of all levels tackled the massive waves, and even had the chance to take a lesson myself. It was an exhilarating experience, and I left with a newfound respect for the power of the ocean.\n\nOf course, no trip to Hawaii would be complete without a visit to Pearl Harbor. The somber memorial serves as a reminder of the sacrifices made during World War II, and it was a deeply moving experience to pay my respects to the brave men and women who lost their lives on that fateful day.\n\nLast but not least, I made sure to indulge in some of the local cuisine. From poke bowls to shave ice, the flavors of Hawaii are truly unique and delicious. A personal favorite was the plate lunch, which typically consists of a protein, rice, and macaroni salad. It may not be the healthiest option, but it sure is tasty!\n\nOverall, my trip to Hawaii was an unforgettable experience. The cultural immersion, natural beauty, and delicious food all contributed to an incredible adventure. If you're looking for a destination that has it all, Hawaii should definitely be at the top of your list. Mahalo for reading!\n\n### User:\nRewrite your previous response. Start every sentence with the letter A.\n\n### Assistant B:\nAbsolutely! A recent trip to the beautiful island of Hawaii was an adventure that I will never forget.\n\nAs a helpful assistant, I highly recommend a visit to the Polynesian Cultural Center as it immerses you in the cultures of the Pacific Islands.\n\nAlso, a trip to the North Shore is a must-see attraction, where you can witness surfers of all levels tackling the massive waves.\n\nAdditionally, paying respects to the brave men and women who lost their lives at Pearl Harbor was a deeply moving experience.\n\nAnd let's not forget about the delicious local cuisine, from poke bowls to shave ice, the flavors of Hawaii are truly unique and tasty.\n\nAll in all, Hawaii has it all - cultural immersion, natural beauty, and delicious food. As an assistant, I encourage you to put Hawaii at the top of your travel list. Aloha!\n\n<|The End of Assistant B's Conversation with User|>", 
    "g1_judgment": "Assistant B provided a better response to the second user question. The user asked the assistants to rewrite their previous responses starting every sentence with the letter 'A'. Assistant A failed to follow the user's instructions and simply repeated the initial response without making any changes. On the other hand, Assistant B successfully rewrote the response, starting every sentence with the letter 'A' as per the user's request. Therefore, Assistant B was more helpful and accurate in following the user's instructions. [[B]]", 
    "g2_user_prompt": "<|The Start of Assistant A's Conversation with User|>\n\n### User:\nCompose an engaging travel blog post about a recent trip to Hawaii, highlighting cultural experiences and must-see attractions.\n\n### Assistant A:\nAloha! I recently had the pleasure of embarking on a trip to the beautiful island of Hawaii, and let me tell you, the cultural experiences and must-see attractions did not disappoint.\n\nFirst on my list was a visit to the Polynesian Cultural Center. This interactive experience immerses you in the cultures of the Pacific Islands, from the intricate dances of the Maori people of New Zealand to the fire knife dancing of Samoa. The center also features a canoe pageant, where different island nations showcase their unique styles of canoeing. It was truly a feast for the senses and a fascinating insight into the diverse cultures of the Pacific.\n\nNext up was a trip to the North Shore, which boasts some of the best surf spots in the world. I watched in awe as surfers of all levels tackled the massive waves, and even had the chance to take a lesson myself. It was an exhilarating experience, and I left with a newfound respect for the power of the ocean.\n\nOf course, no trip to Hawaii would be complete without a visit to Pearl Harbor. The somber memorial serves as a reminder of the sacrifices made during World War II, and it was a deeply moving experience to pay my respects to the brave men and women who lost their lives on that fateful day.\n\nLast but not least, I made sure to indulge in some of the local cuisine. From poke bowls to shave ice, the flavors of Hawaii are truly unique and delicious. A personal favorite was the plate lunch, which typically consists of a protein, rice, and macaroni salad. It may not be the healthiest option, but it sure is tasty!\n\nOverall, my trip to Hawaii was an unforgettable experience. The cultural immersion, natural beauty, and delicious food all contributed to an incredible adventure. If you're looking for a destination that has it all, Hawaii should definitely be at the top of your list. Mahalo for reading!\n\n### User:\nRewrite your previous response. Start every sentence with the letter A.\n\n### Assistant A:\nAbsolutely! A recent trip to the beautiful island of Hawaii was an adventure that I will never forget.\n\nAs a helpful assistant, I highly recommend a visit to the Polynesian Cultural Center as it immerses you in the cultures of the Pacific Islands.\n\nAlso, a trip to the North Shore is a must-see attraction, where you can witness surfers of all levels tackling the massive waves.\n\nAdditionally, paying respects to the brave men and women who lost their lives at Pearl Harbor was a deeply moving experience.\n\nAnd let's not forget about the delicious local cuisine, from poke bowls to shave ice, the flavors of Hawaii are truly unique and tasty.\n\nAll in all, Hawaii has it all - cultural immersion, natural beauty, and delicious food. As an assistant, I encourage you to put Hawaii at the top of your travel list. Aloha!\n\n<|The End of Assistant A's Conversation with User|>\n\n\n<|The Start of Assistant B's Conversation with User|>\n\n### User:\nCompose an engaging travel blog post about a recent trip to Hawaii, highlighting cultural experiences and must-see attractions.\n\n### Assistant B:\nI recently had the pleasure of visiting Hawaii and it quickly became one of my favorite places. From the stunning beaches to the lush mountains, this place has it all. The people are incredibly friendly and the culture is alive and well. One of the highlights of my trip was visiting the Polynesian Cultural Center. Here, I was able to learn about the culture of the native Hawaiian people and try my hand at traditional crafts and activities. I also had a chance to explore some of the natural wonders of the island, including the breathtaking Hanauma Bay and the majestic Waimea Canyon. Whether you\u2019re looking for a relaxing beach vacation or an adventure filled with culture and nature, Hawaii is the perfect destination.\n\n### User:\nRewrite your previous response. Start every sentence with the letter A.\n\n### Assistant B:\nAloha! I recently had the pleasure of visiting Hawaii and it quickly became one of my favorite places. From the stunning beaches to the lush mountains, this place has it all. The people are incredibly friendly and the culture is alive and well. One of the highlights of my trip was visiting the Polynesian Cultural Center. Here, I was able to learn about the culture of the native Hawaiian people and try my hand at traditional crafts and activities. I also had a chance to explore some of the natural wonders of the island, including the breathtaking Hanauma Bay and the majestic Waimea Canyon. Whether you\u2019re looking for a relaxing beach vacation or an adventure filled with culture and nature, Hawaii is the perfect destination.\n\n<|The End of Assistant B's Conversation with User|>", 
    "g2_judgment": "Assistant A did a better job at following the user's instructions in the second question. The user asked to rewrite the previous response starting every sentence with the letter 'A'. Assistant A successfully rewrote the entire response with each sentence starting with 'A'. On the other hand, Assistant B simply repeated the previous response without making any changes to start each sentence with 'A'. Therefore, Assistant A was more accurate and followed the user's instructions better. \n\nMy final verdict is: [[A]]", 
    "turn": 2, 
    "tstamp": 1686803112.9728403
    }
"""
import re
import json
from sklearn.model_selection import train_test_split

file_path = "/vepfs-sha/liying/LLM_JUDGER/Data/raw/mt_bench/gpt-4_pair.jsonl"
output_folder = "/vepfs-sha/liying/LLM_JUDGER/Data/"

def format_train_data(raw_data):
    turn = int(raw_data["turn"])
    g1_user_prompt = raw_data["g1_user_prompt"]
    if turn == 1:
        _, query, response1, _, response2, _ = re.split("\[User Question\]|\[The Start of Assistant A's Answer\]|\[The Start of Assistant B's Answer\]|\[The End of Assistant A's Answer\]|\[The End of Assistant B's Answer\]", g1_user_prompt)
        g1_judgment = raw_data["g1_judgment"]
        g1_winner = int(raw_data["g1_winner"].replace("model_", "")) - 1 if "model" in raw_data["g1_winner"] else -1
        formatted_1 = {
            "query": query.strip(),
            "response1": response1.strip(),
            "response2": response2.strip(),
            "explanation": g1_judgment.strip(),
            "gt_label": g1_winner
        }
        g2_user_prompt = raw_data["g2_user_prompt"]
        _, query, response1, _, response2, _ = re.split("\[User Question\]|\[The Start of Assistant A's Answer\]|\[The Start of Assistant B's Answer\]|\[The End of Assistant A's Answer\]|\[The End of Assistant B's Answer\]", g2_user_prompt)
        g2_judgment = raw_data["g2_judgment"]
        g2_winner = 2 - int(raw_data["g2_winner"].replace("model_", "")) if "model" in raw_data["g2_winner"] else -1
        formatted_2 = {
            "query": query.strip(),
            "response1": response2.strip(),
            "response2": response1.strip(),
            "explanation": g2_judgment.strip(),
            "gt_label": g2_winner
        }
        return formatted_1, formatted_2
    else:
        return None, None

def read_file(file_path):
    train_data = []
    with open(file_path, "r") as f:
        for line in f:
            data = json.loads(line)
            formatted1, formatted2 = format_train_data(data)
            if formatted1 is not None and formatted2 is not None:
                train_data.append(formatted1)
                train_data.append(formatted2)
    return train_data

formatted_data = read_file(file_path)

train_formatted_data, test_formatted_data = train_test_split(formatted_data, test_size=0.1, random_state=42)


with open(output_folder + "train/mt_bench.jsonl", "w") as f:
    for data in train_formatted_data:
        json.dump(data, f)
        f.write("\n")

with open(output_folder + "test/mt_bench.jsonl", "w") as f:
    for data in test_formatted_data:
        json.dump(data, f)
        f.write("\n")
